<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Client Side Pagination in DataGrid - jQuery EasyUI Demo</title>

</head>
<body>
	<div id="tb6" ></div>
	<script type="text/javascript" th:inline="none">
		var row6;
	
		$('#tb6').datagrid({
			border:false,
			fit:true,
			singleSelect:true,
			pagination:true,
			pageSize : 10,
			pageList : [10,20,100],
			autoRowHeight:false,
			url:'/getAppRpt',
			method:'post',
			toolbar: [{
				text:'手动执行',
				iconCls:'icon-sum',
				handler:function(){
					$('#tb6').datagrid('reload');
				}
			},{
				text:'刷新',
				iconCls:'icon-reload',
				handler:function(){
					$('#tb6').datagrid('reload');
				}
			},{
				text:'帮助',
				iconCls:'icon-help',
				handler:function(){
					$.messager.alert('帮助','系统会每天扫描所有APP的管理员状态，并生成此报告，默认关闭，你可以在系统配置中打开它，你也可以手动执行，不过会等上一段时间。<br>'+
							'1.无颜色代表至少一个管理员存活<br>'+
							'2.<font color=red>红色</font>代表全局无管理员或者无管理员存活<br>'+
							'3.<font color=gray>灰色</font>代表无效全局','');
				}
			}],
			columns : [[
				{field : 'rptDt',title : '报告时间',align : 'center',
					formatter: function(value,row,index){
						if(value==null||value==''){
							return '';
						}
						else{
							var date = new Date(value);
							// 格式化日期
							dateTime = date.toLocaleString();
							return dateFormat("YYYY-mm-dd HH:MM:SS", date);
						}
					}	
				},
				{field : 'tenantId',title : '租户ID',align : 'center'},
				{field : 'totalUser',title : '用户总数',align : 'center'},
				{field : 'totalGlobalAdmin',title : '全局管理员总数',align : 'center'},
				{field : 'enableGlobalAdmin',title : '存活的全局管理员总数',align : 'center'},
				{field : 'disableGloablAdmin',title : '禁止的全局管理员总数',align : 'center'}
			]],
            onLoadError: function (data){
            	console.log(data);
            	$.messager.alert('错误', data.responseText ,'error');
				$('#tb6').datagrid('loadData',{'total':0,'rows':[]});
            },
			rowStyler:function(index,row){
				if (row.enableGlobalAdmin=='0'){
					return 'background-color:#FF3300';
				}				
				if (row.rptDt==null||row.rptDt==''){
					return 'background-color:#A9A9A9';
				}
			}
		});
		
		function dateFormat(fmt, date) {
		    let ret;
		    const opt = {
		        "Y+": date.getFullYear().toString(),        // 年
		        "m+": (date.getMonth() + 1).toString(),     // 月
		        "d+": date.getDate().toString(),            // 日
		        "H+": date.getHours().toString(),           // 时
		        "M+": date.getMinutes().toString(),         // 分
		        "S+": date.getSeconds().toString()          // 秒
		        // 有其他格式化字符需求可以继续添加，必须转化成字符串
		    };
		    for (let k in opt) {
		        ret = new RegExp("(" + k + ")").exec(fmt);
		        if (ret) {
		            fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")))
		        };
		    };
		    return fmt;
		}
		
	</script>
</body>
</html>
